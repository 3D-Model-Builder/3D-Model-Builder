<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Model Builder</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #container { width: 100vw; height: 100vh; }
        #controlsContainer { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            background: #fff; 
            padding: 10px; 
            border-radius: 5px; 
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); 
            transition: all 0.3s ease;
            width: 300px;
            height: auto;
            resize: both;
            overflow: auto;
        }
        #controlsContainer.minimized { 
            width: 50px; 
            height: 50px; 
            overflow: hidden; 
            border-radius: 50%; 
            padding: 0; 
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            right: 10px;
            bottom: 10px;
            top: auto;
            left: auto;
        }
        #controlsContainer.minimized #controls { display: none; }
        #controlsContainer.minimized #restoreButton { display: block; }
        #controlsContainer #minimizeButton { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            width: 30px; 
            height: 30px; 
            background: #f0f0f0; 
            border: none; 
            border-radius: 50%; 
            cursor: pointer; 
        }
        #controlsContainer #restoreButton { 
            display: none; 
            position: absolute; 
            bottom: 10px; 
            right: 10px; 
            width: 30px; 
            height: 30px; 
            background: #f0f0f0; 
            border: none; 
            border-radius: 50%; 
            cursor: pointer; 
        }
        #controlsContainer #minimizeButton img,
        #controlsContainer #restoreButton img {
            width: 20px; 
            height: 20px; 
        }
        #controlsContainer #codeOutput { 
            margin-top: 20px; 
            white-space: pre; 
            border: 1px solid #ccc; 
            padding: 10px; 
            display: none; 
        }
        .control-group { margin-bottom: 10px; }
        .joystick { 
            position: absolute; 
            bottom: 50px; 
            background: rgba(255, 255, 255, 0.5); 
            border-radius: 50%; 
            width: 100px; 
            height: 100px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            user-select: none; 
            touch-action: none;
        }
        .joystick div { 
            width: 50px; 
            height: 50px; 
            background: rgba(0, 0, 0, 0.5); 
            border-radius: 50%; 
        }
        .joystick.left { left: 50px; }
        .joystick.right { right: 50px; }
        .toolbar {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #fff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
        .toolbar button {
            display: block;
            width: 30px;
            height: 30px;
            margin-bottom: 10px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="controlsContainer">
        <button id="minimizeButton" onclick="minimizeControls()">
            <img src="https://img.icons8.com/ios/50/000000/minus.png" alt="Minimize" />
        </button>
        <button id="restoreButton" onclick="restoreControls()">
            <img src="https://img.icons8.com/ios/50/000000/plus.png" alt="Restore" />
        </button>
        <div id="controls">
            <h2>3D Model Builder</h2>
            <div class="control-group">
                <label for="shape">Shape:</label>
                <select id="shape">
                    <option value="cube">Cube</option>
                    <option value="sphere">Sphere</option>
                    <option value="cylinder">Cylinder</option>
                </select>
            </div>
            <div class="control-group">
                <label for="color">Color:</label>
                <input type="color" id="color" value="#ff0000">
            </div>
            <div class="control-group">
                <button onclick="addShape()">Add Shape</button>
                <button onclick="removeShape()">Remove Shape</button>
                <button onclick="clearAllShapes()">Clear All Shapes</button>
                <button onclick="generateCode()">Generate C# Code</button>
                <button onclick="toggleCodeVisibility()">Toggle Code Visibility</button>
            </div>
            <div class="control-group">
                <label for="shapeSelect">Select Shape:</label>
                <select id="shapeSelect" onchange="selectShape()">
                    <option value="">-- None --</option>
                </select>
            </div>
            <div class="control-group">
                <label>Move X:</label>
                <input type="range" id="moveX" min="-5" max="5" step="0.1" value="0" oninput="moveShape()">
            </div>
            <div class="control-group">
                <label>Move Y:</label>
                <input type="range" id="moveY" min="-5" max="5" step="0.1" value="0" oninput="moveShape()">
            </div>
            <div class="control-group">
                <label>Move Z:</label>
                <input type="range" id="moveZ" min="-5" max="5" step="0.1" value="0" oninput="moveShape()">
            </div>
            <div class="control-group">
                <label>Scale X:</label>
                <input type="range" id="scaleX" min="0.1" max="5" step="0.1" value="1" oninput="scaleShape()">
            </div>
            <div class="control-group">
                <label>Scale Y:</label>
                <input type="range" id="scaleY" min="0.1" max="5" step="0.1" value="1" oninput="scaleShape()">
            </div>
            <div class="control-group">
                <label>Scale Z:</label>
                <input type="range" id="scaleZ" min="0.1" max="5" step="0.1" value="1" oninput="scaleShape()">
            </div>
            <div id="codeOutput"></div>
        </div>
    </div>
    <div class="toolbar">
        <button onclick="useMoveTool()">M</button>
        <button onclick="useRotateTool()">R</button>
        <button onclick="useScaleTool()">S</button>
    </div>
    <div class="joystick left">
        <div></div>
    </div>
    <div class="joystick right">
        <div></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Setup scene, camera, and renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('container').appendChild(renderer.domElement);

        // Add a basic ambient light
        const light = new THREE.AmbientLight(0x404040);
        scene.add(light);

        // Position the camera
        camera.position.z = 5;

        // Variables for shape management
        const shapes = [];
        const shapeDetails = [];
        let selectedShape = null;
        let controlsMinimized = false;

        // Variables for tool management
        let activeTool = 'move';

        // Function to add a shape to the scene
        function addShape() {
            const shapeType = document.getElementById('shape').value;
            const color = document.getElementById('color').value;
            let shape;

            switch (shapeType) {
                case 'cube':
                    shape = new THREE.Mesh(
                        new THREE.BoxGeometry(1, 1, 1),
                        new THREE.MeshBasicMaterial({ color: color })
                    );
                    break;
                case 'sphere':
                    shape = new THREE.Mesh(
                        new THREE.SphereGeometry(0.5, 32, 32),
                        new THREE.MeshBasicMaterial({ color: color })
                    );
                    break;
                case 'cylinder':
                    shape = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.5, 0.5, 1, 32),
                        new THREE.MeshBasicMaterial({ color: color })
                    );
                    break;
                default:
                    return;
            }

            shapes.push(shape);
            shapeDetails.push({
                type: shapeType,
                color: color,
                position: [0, 0, 0],
                scale: [1, 1, 1]
            });
            scene.add(shape);
            updateShapeSelectOptions();
        }

        // Function to remove the selected shape from the scene
        function removeShape() {
            if (selectedShape) {
                scene.remove(selectedShape);
                const shapeIndex = shapes.indexOf(selectedShape);
                shapes.splice(shapeIndex, 1);
                shapeDetails.splice(shapeIndex, 1);
                selectedShape = null;
                updateShapeSelectOptions();
            }
        }

        // Function to clear all shapes from the scene
        function clearAllShapes() {
            shapes.forEach(shape => scene.remove(shape));
            shapes.length = 0;
            shapeDetails.length = 0;
            selectedShape = null;
            updateShapeSelectOptions();
        }

        // Function to update shape selection dropdown options
        function updateShapeSelectOptions() {
            const shapeSelect = document.getElementById('shapeSelect');
            shapeSelect.innerHTML = '<option value="">-- None --</option>';
            shapes.forEach((shape, index) => {
                shapeSelect.innerHTML += `<option value="${index}">Shape ${index + 1}</option>`;
            });
        }

        // Function to select a shape
        function selectShape() {
            const shapeSelect = document.getElementById('shapeSelect');
            const shapeIndex = shapeSelect.value;
            if (shapeIndex !== '') {
                selectedShape = shapes[shapeIndex];
                const details = shapeDetails[shapeIndex];

                // Update sliders with selected shape details
                document.getElementById('moveX').value = details.position[0];
                document.getElementById('moveY').value = details.position[1];
                document.getElementById('moveZ').value = details.position[2];
                document.getElementById('scaleX').value = details.scale[0];
                document.getElementById('scaleY').value = details.scale[1];
                document.getElementById('scaleZ').value = details.scale[2];
            } else {
                selectedShape = null;
            }
        }

        // Function to move the selected shape
        function moveShape() {
            if (selectedShape) {
                selectedShape.position.set(
                    parseFloat(document.getElementById('moveX').value),
                    parseFloat(document.getElementById('moveY').value),
                    parseFloat(document.getElementById('moveZ').value)
                );
                updateShapeDetails();
            }
        }

        // Function to scale the selected shape
        function scaleShape() {
            if (selectedShape) {
                selectedShape.scale.set(
                    parseFloat(document.getElementById('scaleX').value),
                    parseFloat(document.getElementById('scaleY').value),
                    parseFloat(document.getElementById('scaleZ').value)
                );
                updateShapeDetails();
            }
        }

        // Function to update the shape details
        function updateShapeDetails() {
            const shapeSelect = document.getElementById('shapeSelect');
            const shapeIndex = shapeSelect.value;
            if (shapeIndex !== '') {
                const details = shapeDetails[shapeIndex];
                details.position = selectedShape.position.toArray();
                details.scale = selectedShape.scale.toArray();
            }
        }

        // Function to generate C# code
        function generateCode() {
            let code = '';
            shapeDetails.forEach((details, index) => {
                code += `// Shape ${index + 1}\n`;
                code += `GameObject shape${index + 1} = GameObject.CreatePrimitive(PrimitiveType.${details.type.toUpperCase()});\n`;
                code += `shape${index + 1}.transform.position = new Vector3(${details.position[0]}, ${details.position[1]}, ${details.position[2]});\n`;
                code += `shape${index + 1}.transform.localScale = new Vector3(${details.scale[0]}, ${details.scale[1]}, ${details.scale[2]});\n`;
                code += `shape${index + 1}.GetComponent<Renderer>().material.color = new Color(${new THREE.Color(details.color).r}, ${new THREE.Color(details.color).g}, ${new THREE.Color(details.color).b});\n\n`;
            });
            document.getElementById('codeOutput').textContent = code;
        }

        // Function to toggle code visibility
        function toggleCodeVisibility() {
            const codeOutput = document.getElementById('codeOutput');
            codeOutput.style.display = codeOutput.style.display === 'none' ? 'block' : 'none';
        }

        // Function to minimize controls
        function minimizeControls() {
            document.getElementById('controlsContainer').classList.add('minimized');
            controlsMinimized = true;
        }

        // Function to restore controls
        function restoreControls() {
            document.getElementById('controlsContainer').classList.remove('minimized');
            controlsMinimized = false;
        }

        // Function to use the move tool
        function useMoveTool() {
            activeTool = 'move';
        }

        // Function to use the rotate tool
        function useRotateTool() {
            activeTool = 'rotate';
        }

        // Function to use the scale tool
        function useScaleTool() {
            activeTool = 'scale';
        }

        // Render loop
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        animate();

        // Adjust canvas size on window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Add joystick controls
        const joystickLeft = document.querySelector('.joystick.left div');
        const joystickRight = document.querySelector('.joystick.right div');

        joystickLeft.addEventListener('touchstart', handleJoystickStart, false);
        joystickLeft.addEventListener('touchmove', handleJoystickMove, false);
        joystickLeft.addEventListener('touchend', handleJoystickEnd, false);
        joystickRight.addEventListener('touchstart', handleJoystickStart, false);
        joystickRight.addEventListener('touchmove', handleJoystickMove, false);
        joystickRight.addEventListener('touchend', handleJoystickEnd, false);

        function handleJoystickStart(event) {
            event.preventDefault();
        }

        function handleJoystickMove(event) {
            event.preventDefault();
            const touch = event.targetTouches[0];
            const rect = event.target.getBoundingClientRect();
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            // Handle joystick movement
            // Example: Move the selected shape based on joystick input
            if (selectedShape) {
                if (event.target.parentElement.classList.contains('left')) {
                    selectedShape.position.x += (x / rect.width - 0.5) * 0.1;
                    selectedShape.position.z += (y / rect.height - 0.5) * 0.1;
                } else {
                    selectedShape.position.y += (y / rect.height - 0.5) * 0.1;
                }
                updateShapeDetails();
            }
        }

        function handleJoystickEnd(event) {
            event.preventDefault();
        }
    </script>
</body>
</html>
